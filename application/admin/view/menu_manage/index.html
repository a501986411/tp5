{include file='public:_header'/}
<body>
<nav class="breadcrumb"><i class="Hui-iconfont">&#xe67f;</i> 首页 <span class="c-gray en">&gt;</span> 系统设置 <span class="c-gray en">&gt;</span> 菜单管理 <a class="btn btn-success radius r" style="line-height:1.6em;margin-top:3px" href="javascript:location.replace(location.href);" title="刷新" ><i class="Hui-iconfont">&#xe68f;</i></a></nav>
<div class="page-container" style="padding-top: 0px">
    <div class="cl pd-5 bg-1 bk-gray mt-10">
        <span class="l">
            <button type="button" class="btn btn-success radius"  id="add_menu" >新增</button>
            <button type="button" class="btn btn-primary radius" id="use_true">启用</button>
            <button type="button" class="btn btn-warning radius" id="use_false">停用</button>
        </span>
        <span class="r">共有数据：<strong>{:count($menuList)}</strong> 条</span>
    </div>
    <div class="mt-20">
        <table id="menu_table" class="table table-border table-bordered table-hover table-bg table-sort">
            <thead>
            <tr class="text-c">
                <th width="25"><input type="checkbox" name="" value=""></th>
                <th width="80">名称</th>
                <th width="100">上级菜单名称</th>
                <th width="40">状态</th>
            </tr>
            </thead>
            <tbody>
            <?php foreach($menuList as $k=>$v):?>
            <tr class="text-c">
                <td><input type="checkbox" value="1" name=""></td>
                <td>{$v['name']}</td>
                <td>{$v['pid_name']}</td>
                <td>{$v['status_name']}</td>
                </tr>
            <?php endforeach;?>
            </tbody>
        </table>
    </div>
</div>
{include file='public:_footer'/}
<script>
    $(document).ready(function(){
        var $table = $("#menu_table");
        var $addMenu = $('#add_menu');
        var $useTrue = $('#use_true');
        var $useFalse = $('#use_false');
        $table.dataTable({
            dom: '<"top"lf>rt<"bottom"ip><"clear">',
        });


        $addMenu.click(function(){
            var w = 800;
            var h=($(window).height() - 150);
            layer.open({
                type:1,
                content:$("#menu_info_dlg").html(),
                area: [w+'px', h +'px'],
                fix: false, //不固定
                maxmin: true,
                shade:0.4,
                title: '新增菜单',
                btn:['确定','取消'],
                btnAlign: '1',
                yes:function(){
                },
            });
        });

        //停用操作
        $useFalse.click(function(){
            var selectRow = $table.bootstrapTable('getSelections');
            if($.is_null(selectRow)){
                return false;
            } else {
                var pkArr = [];
                $.each(selectRow,function(k,v){
                    pkArr.push(v.id);
                });
                $.post("{:url('/MenuManage/operateStatus')}",{pkArr:JSON.stringify(pkArr),status:2},function(result){
                    if(result.success){
                        $.reload();
                    }
                    $.dialogMsg({message:result.msg});
                });
            }
        });
        //停用操作
        $useTrue.click(function(){
            var selectRow = $table.bootstrapTable('getSelections');
            if($.is_null(selectRow)){
                return false;
            } else {
                var pkArr = [];
                $.each(selectRow,function(k,v){
                    pkArr.push(v.id);
                });
                $.post("{:url('/MenuManage/operateStatus')}",{pkArr:JSON.stringify(pkArr),status:1},function(result){
                    if(result.success){
                        $.reload();
                    }
                    $.dialogMsg({message:result.msg});
                });
            }
        });
    });

</script>

<script type="text/javascript" src="{$Think.const.STATIC_PATH}lib/datatables/1.10.0/jquery.dataTables.min.js"></script>
<script type="text/javascript" src="{$Think.const.STATIC_PATH}lib/laypage/1.2/laypage.js"></script>
</body>
</html>
{include file='menu_manage/form'/}
